{"version":3,"file":"fjl-input-filter.js","sources":["../../src/Utils.js","../../src/Input.js","../../src/InputFilter.js"],"sourcesContent":["/**\r\n * Same as `console.error`.  Used by *IO variant methods (methods that work with promises) in fjlInputFilter;\r\n * E.g., used as the error catcher on promises returned from IO processes.\r\n * @function module:fjlInputFilter.defaultErrorHandler\r\n * @returns {void}\r\n */\r\nexport const defaultErrorHandler = console.error.bind(console);\r\n","/**\r\n * Created by Ely on 7/24/2014.\r\n */\r\nimport {assign, apply, compose, concat, isString, isArray, isset, defineEnumProps} from 'fjl';\r\nimport {toValidationResult, toValidationOptions, notEmptyValidator} from 'fjl-validator';\r\nimport {defaultErrorHandler} from './Utils';\r\n\r\n/*---------------------------------------------------*/\r\n/* VIRTUAL TYPES AND INTERFACES */\r\n/*---------------------------------------------------*/\r\n/**\r\n * @interface InputValidationResult\r\n * @memberOf fjlInputFilter\r\n * @property {String} name - `Input` this result was generated with.\r\n * @property {Boolean} result - Result of validation.\r\n * @property {Array} messages - Any error messages if `result` is `false`.\r\n * @property {*} value=null - Value tested against (if `filters` exist on given `#Input` object the `value` is what is returned from the results of running filters on value).\r\n * @property {*} rawValue=null - Raw value tested against.\r\n * @property {*} obscuredValue=null - Obscured value if validation `result` is `true`.\r\n * @property {*} filteredValue=null - Filtered result if validation `result` is `true`.\r\n */\r\n\r\n/**\r\n * @interface InputOptions\r\n * @memberOf fjlInputFilter\r\n * @desc Contains rules for validating and/or filtering an input.\r\n * @property {String} name='' - Input's name.\r\n * @property {Boolean} required=false - Whether input is required or not.\r\n * @property {Array} filters=[] - Any filter functions to apply to value.\r\n * @property {Array} validators=[] - Any validators to validate against for given value (to validator).\r\n * @property {Boolean} breakOnFailure=false - Whether or not to 'break' on a validation failure result or not.\r\n * @property {Boolean} valueObscured=false - Whether to obscure the value being tested against (to the assigned places) or not).\r\n * @property {Function} valueObscurator=((x) => x) - Obscurator used for obscuring a value given to validation.\r\n */\r\n\r\nexport const\r\n\r\n    noValidationRequired = (input, value) =>\r\n        !input.required && (\r\n            !isset(value) || (\r\n                (isString(value) || isArray(value)) &&\r\n                !value.length\r\n            )\r\n        ),\r\n\r\n    /**\r\n     * Validates an input object based.\r\n     * @function module:fjlInputFilter.validateInput\r\n     * @param input {Input|InputOptions}\r\n     * @param value {*}\r\n     * @returns {InputValidationResult}\r\n     */\r\n    validateInput = (input, value) => {\r\n        const {validators, filters, breakOnFailure,\r\n                valueObscured, valueObscurator, name} = input;\r\n\r\n        // If value is not required and is `null` or `undefined`\r\n        if (noValidationRequired(input, value)) {\r\n            return toInputValidationResult({\r\n                result: true,\r\n                name: name || '',\r\n                rawValue: value,\r\n                value,\r\n                filteredValue: value,\r\n                obscuredValue: value\r\n            });\r\n        }\r\n\r\n        // Run validation and filtering\r\n        let vResult = runValidators(validators, breakOnFailure, value),\r\n            fResult = runFilters(filters, value),\r\n            oResult = valueObscured && valueObscurator ? valueObscurator(fResult) : fResult;\r\n\r\n        return toInputValidationResult(assign(vResult, {\r\n            name: name || '',\r\n            rawValue: value,\r\n            value: fResult,\r\n            filteredValue: fResult,\r\n            obscuredValue: oResult\r\n        }));\r\n    },\r\n\r\n    /**\r\n     * Validates an input object that may have IOValidators.  Returns\r\n     * a validation result wrapped in a promise.\r\n     * @function module:fjlInputFilter.validateIOInput\r\n     * @param input {Input|InputOptions}\r\n     * @param value {*}\r\n     * @returns {Promise.<InputValidationResult>}\r\n     */\r\n    validateIOInput = (input, value) => {\r\n        const {validators, filters, breakOnFailure,\r\n                valueObscured, valueObscurator} = input;\r\n\r\n        // If not required and value is `null` or `undefined` return truthy result\r\n        if (noValidationRequired(input, value)) {\r\n            return Promise.resolve(\r\n                toInputValidationResult({\r\n                    result: true,\r\n                    name: input.name || '',\r\n                    rawValue: value,\r\n                    value,\r\n                    filteredValue: value,\r\n                    obscuredValue: value\r\n                })\r\n            );\r\n        }\r\n\r\n        let pendingValidation = validators && validators.length ?\r\n            runIOValidators(validators, breakOnFailure, value, input) :\r\n            Promise.resolve({result: true})\r\n        ;\r\n\r\n        return pendingValidation.then(result =>\r\n            runIOFilters(filters, value)\r\n                .then(filteredValue => {\r\n                    result.rawValue = value;\r\n                    result.value = result.filteredValue = filteredValue;\r\n                    result.obscuredValue =\r\n                        valueObscured && valueObscurator ?\r\n                            valueObscurator(filteredValue) : filteredValue;\r\n                    return toInputValidationResult(result);\r\n                })\r\n            );\r\n    },\r\n\r\n    /**\r\n     * Runs validator against given `value`.\r\n     * @function module:fjlInputFilter.runValidators\r\n     * @param validators {Array.<Function>}\r\n     * @param breakOnFailure {Boolean}\r\n     * @param value {*}\r\n     * @returns {*}\r\n     */\r\n    runValidators = (validators, breakOnFailure, value) => {\r\n        let result = true,\r\n            i = 0,\r\n            messageResults = [];\r\n        if (!validators || !validators.length) {\r\n            return toValidationResult({result});\r\n        }\r\n        const limit = validators.length;\r\n        for (; i < limit; i++) {\r\n            const vResult = validators[i](value);\r\n            if (!vResult.result) {\r\n                messageResults.push(vResult.messages);\r\n                result = false;\r\n                if (breakOnFailure) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return toValidationResult({result, messages: concat(messageResults)});\r\n    },\r\n\r\n    /**\r\n     * Runs (possibly) IOValidators against given `value`.\r\n     * @function module:fjlInputFilter.runIOValidators\r\n     * @param validators {Array.<Function>}\r\n     * @param breakOnFailure {Boolean}\r\n     * @param value {*}\r\n     * @param [errorCallback=console.error] {Function}\r\n     * @returns {*}\r\n     */\r\n    runIOValidators = (validators, breakOnFailure, value, errorCallback = defaultErrorHandler) => {\r\n        if (!validators || !validators.length) {\r\n            return Promise.resolve(toValidationResult({result: true}));\r\n        }\r\n        const limit = validators.length,\r\n            pendingResults = [];\r\n        let i = 0,\r\n            result = true;\r\n        for (; i < limit; i++) {\r\n            const validator = validators[i],\r\n                vResult = validator(value);\r\n            if (vResult instanceof Promise) {\r\n                pendingResults.push(vResult.catch(errorCallback));\r\n                continue;\r\n            }\r\n            pendingResults.push(vResult);\r\n            if (!vResult.result) {\r\n                result = false;\r\n                if (breakOnFailure) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return Promise.all(pendingResults)\r\n            .then(results => {\r\n                const failedResults = results.filter(rslt => !rslt.result),\r\n                    interimResult = {\r\n                        result,\r\n                        messages: failedResults.reduce((agg, item) =>\r\n                            agg.concat(item.messages), [])\r\n                    };\r\n                if (failedResults.length) {\r\n                    interimResult.result = false;\r\n                }\r\n                return toValidationResult(interimResult);\r\n            })\r\n            .catch(errorCallback);\r\n    },\r\n\r\n    /**\r\n     * Runs filters on value (successively).\r\n     * @function module:fjlInputFilter.runFilters\r\n     * @param filters {Array.<Function>}\r\n     * @param value {*}\r\n     * @returns {*}\r\n     */\r\n    runFilters = (filters, value) => filters && filters.length ?\r\n        apply(compose, filters)(value) : value,\r\n\r\n    /**\r\n     * Runs filters on value (successively) and returns result wrapped in a promise.\r\n     * @function module:fjlInputFilter.runIOFilters\r\n     * @param filters {Array.<Function>}\r\n     * @param value {*}\r\n     * @param [errorCallback=console.error] {Function}\r\n     * @returns {Promise.<*>}\r\n     */\r\n    runIOFilters = (filters, value, errorCallback = defaultErrorHandler) =>\r\n        runFilters(filters ? filters.map(filter => x => x.then(filter)) : null,\r\n            Promise.resolve(value).catch(errorCallback)),\r\n\r\n    /**\r\n     * Returns an `InputOptions` object from given object and optionally turns the `out` object into\r\n     * said `InputOptions` with firstParam assigned on top of it.\r\n     * @function module:fjlInputFilter.toInput\r\n     * @param inputObj {Object|*} - Object to build `InputOptions` object from.\r\n     * @param [out = {}] {Object|*}\r\n     * @returns {InputOptions}\r\n     */\r\n    toInput = (inputObj, out = {}) => {\r\n        const _inputObj = defineEnumProps([\r\n            [String,    'name', ''],\r\n            [Boolean,   'required', false],\r\n            [Array,     'filters', []],\r\n            [Array,     'validators', []],\r\n            [Boolean,   'breakOnFailure', false]\r\n        ], toValidationOptions(out));\r\n        if (isString(inputObj)) {\r\n            _inputObj.name = inputObj;\r\n        }\r\n        else if (inputObj) {\r\n            assign(_inputObj, inputObj);\r\n        }\r\n        if (_inputObj.required) {\r\n            _inputObj.validators = _inputObj.validators.slice(0);\r\n            _inputObj.validators.push(notEmptyValidator(null));\r\n        }\r\n        return _inputObj;\r\n    },\r\n\r\n    /**\r\n     * Returns an input validation result object with values of given object\r\n     * applied/assigned to it.\r\n     * @function module:fjlInputFilter.toInputValidationResult\r\n     * @param resultObj {Object|*}\r\n     * @returns {InputValidationResult}\r\n     */\r\n    toInputValidationResult = resultObj => {\r\n        const _result = defineEnumProps([\r\n            [String, 'name', ''],\r\n            [Boolean, 'result', false],\r\n            [Array, 'messages', []]\r\n        ], {\r\n            value: null,\r\n            rawValue: null,\r\n            obscuredValue: null,\r\n            filteredValue: null\r\n        });\r\n        return assign(_result, resultObj);\r\n    }\r\n;\r\n\r\n/**\r\n * @memberOf fjlInputFilter\r\n * @class Input\r\n * @extends InputOptions\r\n */\r\nexport class Input {\r\n    constructor (inputObj) {\r\n        toInput(inputObj, this);\r\n    }\r\n    static of (inputObj) {\r\n        return new Input(inputObj);\r\n    }\r\n    validate (value) {\r\n        return validateInput(this, value);\r\n    }\r\n    validateIO (value) {\r\n        return validateIOInput(this, value);\r\n    }\r\n}\r\n","import {partition, foldl, map, assign, keys, toAssocList, fromAssocList, defineEnumProps} from 'fjl';\r\nimport {validateInput, validateIOInput, toInput} from './Input';\r\nimport {defaultErrorHandler} from './Utils';\r\n\r\n/**\r\n * @interface InputFilter {Object.<String, (Input|InputOptions)>}\r\n * @desc Contains input objects to validate against (key-value pair object).\r\n */\r\n\r\n/**\r\n * @interface InputFilterResult\r\n * @memberOf fjlInputFilter\r\n * @property {Boolean} result - Result of validation.\r\n * @property {Object.<String,InputValidationResult>} validInputs - Valid input results object.\r\n * @property {Object.<String,InputValidationResult>} invalidInputs - Invalid input results object.\r\n * @property {Array.<String,InputValidationResult>} validResults - Valid input results associative array.\r\n * @property {Array.<String,InputValidationResult>} invalidResults - Invalid input results associative array.\r\n * @property {Object.<String,Array.<String>>} messages - Error messages (if any) mapped to input names.\r\n */\r\n\r\nexport const\r\n\r\n    /**\r\n     * @function module:fjlInputFilter.validateInputFilter\r\n     * @param inputsObj {InputFilter}\r\n     * @param valuesObj {Object.<String,*>}\r\n     * @returns {InputFilterResult}\r\n     */\r\n    validateInputFilter = (inputsObj, valuesObj) => {\r\n        if (!inputsObj || !valuesObj) {\r\n            return toInputFilterResult({result: false});\r\n        }\r\n        const [validResults, invalidResults] =\r\n            partition(([_, result]) => result.result,\r\n                map(([key, inputObj]) =>\r\n                    [key, validateInput(inputObj, valuesObj[key])],\r\n                    toAssocList(inputsObj)\r\n                )),\r\n            messages = foldl((agg, [key, result]) => {\r\n                agg[key] = result.messages;\r\n                return agg;\r\n            }, {}, invalidResults),\r\n            validInputs = fromAssocList(validResults),\r\n            invalidInputs = fromAssocList(invalidResults),\r\n            result = !invalidResults.length\r\n        ;\r\n        return toInputFilterResult({\r\n            result,\r\n            validInputs,\r\n            invalidInputs,\r\n            validResults,\r\n            invalidResults,\r\n            messages\r\n        });\r\n    },\r\n\r\n    /**\r\n     * @function module:fjlInputFilter.validateIOInputFilter\r\n     * @param inputsObj {InputFilter}\r\n     * @param valuesObj {Object.<String, *>}\r\n     * @param errorHandler {Function}\r\n     * @returns {Promise.<InputFilterResult>}\r\n     */\r\n    validateIOInputFilter = (inputsObj, valuesObj, errorHandler = defaultErrorHandler) => {\r\n        if (!inputsObj || !valuesObj) {\r\n            return Promise.resolve(toInputFilterResult({result: false}));\r\n        }\r\n\r\n        return Promise.all(map(([key, inputObj]) =>\r\n            validateIOInputWithName(inputObj, key, valuesObj[key]),\r\n                toAssocList(inputsObj)\r\n        )).then(assocList => {\r\n            const [validResults, invalidResults] =\r\n                    partition(([_, result]) => result.result, assocList),\r\n                messages = foldl((agg, [key, result]) => {\r\n                    agg[key] = result.messages;\r\n                    return agg;\r\n                }, {}, invalidResults),\r\n                validInputs = fromAssocList(validResults),\r\n                invalidInputs = fromAssocList(invalidResults),\r\n                result = !invalidResults.length\r\n            ;\r\n\r\n            return toInputFilterResult({\r\n                result,\r\n                validInputs,\r\n                invalidInputs,\r\n                validResults,\r\n                invalidResults,\r\n                messages\r\n            });\r\n        },\r\n            errorHandler);\r\n    },\r\n\r\n    /**\r\n     * @function module:fjlInputFilter.validateIOInputWithName\r\n     * @param input {Input|InputOptions}\r\n     * @param name {String}\r\n     * @param value {*}\r\n     * @param errorHandler {Function}\r\n     * @returns {Promise.<Array.<String,InputValidationResult>>}\r\n     */\r\n    validateIOInputWithName = (input, name, value, errorHandler = defaultErrorHandler) =>\r\n        validateIOInput(input, value)\r\n            .then(result => Promise.resolve([name, result]), errorHandler),\r\n\r\n    /**\r\n     * @function module:fjlInputFilter.toInputFilter\r\n     * @param inObj {Object.<String, Object>}\r\n     * @param breakOnFailure {Boolean}\r\n     * @param outObj {Object|*}\r\n     * @returns {InputFilter}\r\n     */\r\n    toInputFilter = (inObj, breakOnFailure = false, outObj = {}) =>\r\n        Object.defineProperties(outObj,\r\n            foldl((agg, [key, inputOpsObj]) => {\r\n                const inputObj = toInput(assign(inputOpsObj, {name: key}));\r\n                inputObj.breakOnFailure = breakOnFailure;\r\n                agg[key] = {\r\n                    value: inputObj,\r\n                    enumerable: true\r\n                };\r\n                return agg;\r\n            }, {}, map(key =>\r\n                [key, inObj[key]],\r\n                keys(inObj)\r\n            ))\r\n        ),\r\n\r\n    /**\r\n     * @function module:fjlInputFilter.toInputFilterResult\r\n     * @param inResult {Object}\r\n     * @param outResult {Object|*}\r\n     * @returns {InputFilterResult}\r\n     */\r\n    toInputFilterResult = (inResult, outResult = {}) => {\r\n        const _outResult = defineEnumProps([\r\n            [Boolean, 'result', false],\r\n            [Object,  'messages', {}],\r\n            [Object,  'validInputs', {}],\r\n            [Object,  'invalidInputs', {}],\r\n            [Array,   'validResults', []],\r\n            [Array,   'invalidResults', []]\r\n        ], outResult);\r\n        return inResult ? assign(_outResult, inResult) : _outResult;\r\n    }\r\n\r\n;\r\n\r\n/**\r\n * @class InputFilter\r\n */\r\nexport class InputFilter {\r\n    constructor (inputsObj, breakOnFailure = false) {\r\n        toInputFilter(inputsObj, breakOnFailure, this);\r\n    }\r\n    static of (inputsObj, breakOnFailure) {\r\n        return new InputFilter(inputsObj, breakOnFailure);\r\n    }\r\n    validate (data) {\r\n        return validateInputFilter(this, data);\r\n    }\r\n    validateIO (data) {\r\n        return validateIOInputFilter(this, data);\r\n    }\r\n}\r\n"],"names":["defaultErrorHandler","console","error","bind","noValidationRequired","input","value","required","isset","isString","isArray","length","validateInput","validators","filters","breakOnFailure","valueObscured","valueObscurator","name","toInputValidationResult","result","rawValue","filteredValue","obscuredValue","vResult","runValidators","fResult","runFilters","oResult","assign","validateIOInput","Promise","resolve","pendingValidation","runIOValidators","then","runIOFilters","i","messageResults","toValidationResult","limit","push","messages","concat","errorCallback","pendingResults","validator","all","results","failedResults","filter","rslt","interimResult","reduce","agg","item","apply","compose","map","x","toInput","inputObj","out","_inputObj","defineEnumProps","String","Boolean","Array","toValidationOptions","slice","notEmptyValidator","resultObj","_result","Input","validateInputFilter","inputsObj","valuesObj","toInputFilterResult","partition","_","key","toAssocList","validResults","invalidResults","foldl","validInputs","fromAssocList","invalidInputs","validateIOInputFilter","errorHandler","validateIOInputWithName","assocList","toInputFilter","inObj","outObj","Object","defineProperties","inputOpsObj","enumerable","keys","inResult","outResult","_outResult","InputFilter","data"],"mappings":"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"}